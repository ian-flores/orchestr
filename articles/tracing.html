<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Traced Agent Workflows • orchestr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Traced Agent Workflows">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orchestr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ian-flores/orchestr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Traced Agent Workflows</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ian-flores/orchestr/blob/main/vignettes/tracing.Rmd" class="external-link"><code>vignettes/tracing.Rmd</code></a></small>
      <div class="d-none name"><code>tracing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="why-trace-agent-workflows">Why Trace Agent Workflows?<a class="anchor" aria-label="anchor" href="#why-trace-agent-workflows"></a>
</h2>
<p>Agent workflows are opaque by default. When you call
<code>graph$invoke()</code>, a chain of LLM calls, tool executions, and
routing decisions happens behind the scenes. If the agent produces a
wrong answer, takes too long, or costs more than expected, you have no
way to diagnose the problem without structured observability.</p>
<p>Tracing solves three concrete problems:</p>
<ul>
<li><p><strong>Debugging</strong>: When an agent gives a wrong answer,
traces show you exactly which node produced the bad output, what inputs
it received, and whether any tool calls failed. Instead of re-running
the entire workflow with print statements, you inspect the
trace.</p></li>
<li><p><strong>Performance</strong>: Each span records its duration. In
a pipeline with three agents, the trace immediately shows whether the
bottleneck is the profiler (waiting on the LLM) or the reporter
(generating a long response). You optimize the right thing.</p></li>
<li><p><strong>Cost control</strong>: LLM calls cost money, and
multi-agent workflows multiply the spend. Traced workflows record token
counts and estimated costs per span. You can spot a supervisor that is
routing inefficiently (too many iterations) or an agent that is sending
unnecessarily long prompts.</p></li>
</ul>
<p>orchestr integrates with <a href="https://github.com/ian-flores/securetrace" class="external-link">securetrace</a> to give
you full observability into agent graph execution. Pass a
<code>Trace</code> object to <code>$invoke()</code> or
<code>$stream()</code> and every node gets its own span – timing,
errors, and metadata are captured automatically.</p>
<p>The trace structure follows a simple hierarchy:</p>
<pre><code> Trace: "my-pipeline-run"
 |
 +-- Span: node:profiler   [2.1s, 180 tokens, $0.003]
 |
 +-- Span: node:analyst    [2.5s, 220 tokens, $0.004]
 |
 +-- Span: node:reporter   [1.5s, 150 tokens, $0.002]</code></pre>
<p>Each trace contains one or more spans. Each span corresponds to a
graph node execution and carries timing, token usage, cost, and error
information.</p>
<p>For orchestr basics, see <code><a href="../articles/quickstart.html">vignette("quickstart")</a></code>. For
securetrace fundamentals, see
<code><a href="https://ian-flores.github.io/securetrace/articles/observability.html" class="external-link">vignette("observability", package = "securetrace")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"orchestr"</span>, <span class="st">"securetrace"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-tracing">Basic Tracing<a class="anchor" aria-label="anchor" href="#basic-tracing"></a>
</h2>
<p>The <code>trace=</code> parameter on <code>AgentGraph$invoke()</code>
accepts a <code><a href="https://ian-flores.github.io/securetrace/reference/Trace.html" class="external-link">securetrace::Trace</a></code> object. When provided,
orchestr wraps each node execution in a span named
<code>"node:&lt;name&gt;"</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ian-flores.github.io/orchestr/">orchestr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ellmer.tidyverse.org" class="external-link">ellmer</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ian-flores.github.io/securetrace/" class="external-link">securetrace</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">analyst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"analyst"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"You are a data analyst."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/react_graph.html">react_graph</a></span><span class="op">(</span><span class="va">analyst</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a trace and pass it to invoke</span></span>
<span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://ian-flores.github.io/securetrace/reference/Trace.html" class="external-link">Trace</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"analyst-run"</span>, metadata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>task <span class="op">=</span> <span class="st">"mtcars"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">graph</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Describe the mtcars dataset."</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trace <span class="op">=</span> <span class="va">tr</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">end</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect the spans</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trace: analyst-run</span></span>
<span><span class="co">#&gt;   Spans: 1</span></span>
<span><span class="co">#&gt;   Duration: 2.3s</span></span>
<span><span class="co">#&gt;   node:analyst -- 2.3s (completed)</span></span></code></pre></div>
<p>If securetrace is not installed, passing <code>trace=</code> issues a
warning and execution continues without tracing.</p>
</div>
<div class="section level2">
<h2 id="pipeline-tracing">Pipeline Tracing<a class="anchor" aria-label="anchor" href="#pipeline-tracing"></a>
</h2>
<p>In a pipeline, each agent becomes its own span. This makes it
straightforward to identify where time and tokens are spent across the
chain. If one agent is disproportionately slow or expensive, the trace
tells you immediately.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">profiler</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"profiler"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Profile datasets: columns, types, distributions."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">analyst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"analyst"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Identify patterns and correlations from a data profile."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reporter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"reporter"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Write a non-technical summary of analytical findings."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pipeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pipeline_graph.html">pipeline_graph</a></span><span class="op">(</span><span class="va">profiler</span>, <span class="va">analyst</span>, <span class="va">reporter</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://ian-flores.github.io/securetrace/reference/Trace.html" class="external-link">Trace</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"data-pipeline"</span><span class="op">)</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">pipeline</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Analyze mtcars fuel efficiency."</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trace <span class="op">=</span> <span class="va">tr</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">end</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Three spans, one per pipeline stage</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trace: data-pipeline</span></span>
<span><span class="co">#&gt;   Spans: 3</span></span>
<span><span class="co">#&gt;   Duration: 6.1s</span></span>
<span><span class="co">#&gt;   node:profiler  -- 2.1s (completed)</span></span>
<span><span class="co">#&gt;   node:analyst   -- 2.5s (completed)</span></span>
<span><span class="co">#&gt;   node:reporter  -- 1.5s (completed)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="supervisor-tracing">Supervisor Tracing<a class="anchor" aria-label="anchor" href="#supervisor-tracing"></a>
</h2>
<p>Supervisor graphs produce a richer trace because the supervisor may
route to multiple workers across several iterations. Each supervisor
decision and worker execution gets its own span. This visibility is
especially valuable for supervisors because the routing behavior is
non-deterministic – you need the trace to understand what actually
happened.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">supervisor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"supervisor"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"You coordinate workers to solve tasks."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">math_worker</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"math"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Solve math problems step by step."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">writing_worker</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"writing"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Help with writing tasks."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/supervisor_graph.html">supervisor_graph</a></span><span class="op">(</span></span>
<span>  supervisor <span class="op">=</span> <span class="va">supervisor</span>,</span>
<span>  workers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>math <span class="op">=</span> <span class="va">math_worker</span>, writing <span class="op">=</span> <span class="va">writing_worker</span><span class="op">)</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://ian-flores.github.io/securetrace/reference/Trace.html" class="external-link">Trace</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"supervisor-run"</span><span class="op">)</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">graph</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Write a poem that includes the first 5 primes."</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trace <span class="op">=</span> <span class="va">tr</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">end</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Spans show the routing pattern</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trace: supervisor-run</span></span>
<span><span class="co">#&gt;   Spans: 4</span></span>
<span><span class="co">#&gt;   Duration: 8.2s</span></span>
<span><span class="co">#&gt;   node:supervisor -- 1.2s (completed)</span></span>
<span><span class="co">#&gt;   node:math       -- 1.8s (completed)</span></span>
<span><span class="co">#&gt;   node:supervisor -- 1.5s (completed)</span></span>
<span><span class="co">#&gt;   node:writing    -- 3.7s (completed)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="streaming-with-traces">Streaming with Traces<a class="anchor" aria-label="anchor" href="#streaming-with-traces"></a>
</h2>
<p><code>$stream()</code> also accepts <code>trace=</code>. You get both
state snapshots and full tracing, which is useful for interactive
applications that need progress updates while also recording full
observability data for later analysis.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://ian-flores.github.io/securetrace/reference/Trace.html" class="external-link">Trace</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"streamed-pipeline"</span><span class="op">)</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">snapshots</span> <span class="op">&lt;-</span> <span class="va">pipeline</span><span class="op">$</span><span class="fu">stream</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Analyze iris dataset."</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trace <span class="op">=</span> <span class="va">tr</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">end</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># State snapshots for progress reporting</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">snap</span> <span class="kw">in</span> <span class="va">snapshots</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Step %d, node: %s\n"</span>, <span class="va">snap</span><span class="op">$</span><span class="va">step</span>, <span class="va">snap</span><span class="op">$</span><span class="va">node</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Step 1, node: profiler</span></span>
<span><span class="co">#&gt; Step 2, node: analyst</span></span>
<span><span class="co">#&gt; Step 3, node: reporter</span></span>
<span></span>
<span><span class="co"># Trace for observability</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cost-accounting">Cost Accounting<a class="anchor" aria-label="anchor" href="#cost-accounting"></a>
</h2>
<p>When agent nodes make LLM calls, securetrace can track token usage
and compute cost. Combine the <code>trace=</code> parameter with
<code><a href="https://ian-flores.github.io/securetrace/reference/trace_total_cost.html" class="external-link">trace_total_cost()</a></code> to monitor spend across an entire graph
run. This is critical for production deployments where multi-agent
workflows can quickly accumulate costs – a supervisor with 10 iterations
and 3 workers could make 20+ LLM calls in a single invocation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://ian-flores.github.io/securetrace/reference/Trace.html" class="external-link">Trace</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"cost-tracking"</span><span class="op">)</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">graph</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Explain the central limit theorem."</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trace <span class="op">=</span> <span class="va">tr</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">end</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Total cost across all spans</span></span>
<span><span class="fu">securetrace</span><span class="fu">::</span><span class="fu"><a href="https://ian-flores.github.io/securetrace/reference/trace_total_cost.html" class="external-link">trace_total_cost</a></span><span class="op">(</span><span class="va">tr</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.0234</span></span></code></pre></div>
<p>For this to work, the LLM spans must have model and token information
set. If you use orchestr’s built-in Agent class with ellmer, this is
handled automatically when securetrace integration is active.</p>
</div>
<div class="section level2">
<h2 id="exporting-traces">Exporting Traces<a class="anchor" aria-label="anchor" href="#exporting-traces"></a>
</h2>
<div class="section level3">
<h3 id="jsonl-export">JSONL Export<a class="anchor" aria-label="anchor" href="#jsonl-export"></a>
</h3>
<p>Write traced agent runs to a JSONL file for post-hoc analysis. Each
line is a self-contained JSON object representing one span, making it
easy to process with standard tools (jq, pandas, data.table).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ian-flores.github.io/securetrace/reference/jsonl_exporter.html" class="external-link">jsonl_exporter</a></span><span class="op">(</span><span class="st">"agent-traces.jsonl"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://ian-flores.github.io/securetrace/reference/Trace.html" class="external-link">Trace</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"export-demo"</span><span class="op">)</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">pipeline</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Summarize the iris dataset."</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trace <span class="op">=</span> <span class="va">tr</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">end</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export the completed trace</span></span>
<span><span class="fu"><a href="https://ian-flores.github.io/securetrace/reference/export_trace.html" class="external-link">export_trace</a></span><span class="op">(</span><span class="va">exp</span>, <span class="va">tr</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="console-export">Console Export<a class="anchor" aria-label="anchor" href="#console-export"></a>
</h3>
<p>For interactive debugging, use <code><a href="https://ian-flores.github.io/securetrace/reference/console_exporter.html" class="external-link">console_exporter()</a></code> to
print spans as they complete:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ian-flores.github.io/securetrace/reference/console_exporter.html" class="external-link">console_exporter</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://ian-flores.github.io/securetrace/reference/Trace.html" class="external-link">Trace</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"debug-run"</span><span class="op">)</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">graph</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"What is 2 + 2?"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trace <span class="op">=</span> <span class="va">tr</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">end</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ian-flores.github.io/securetrace/reference/export_trace.html" class="external-link">export_trace</a></span><span class="op">(</span><span class="va">exp</span>, <span class="va">tr</span><span class="op">)</span></span>
<span><span class="co">#&gt; [TRACE] debug-run (3.1s)</span></span>
<span><span class="co">#&gt;   [SPAN] node:supervisor -- 1.2s completed</span></span>
<span><span class="co">#&gt;   [SPAN] node:math       -- 0.8s completed</span></span>
<span><span class="co">#&gt;   [SPAN] node:supervisor -- 1.1s completed</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="cloud-native-integration">Cloud-Native Integration<a class="anchor" aria-label="anchor" href="#cloud-native-integration"></a>
</h2>
<p>For production deployments, securetrace supports OTLP export (Jaeger,
Grafana Tempo), Prometheus metrics, and W3C Trace Context propagation.
Rather than duplicating the full setup here, see
<code><a href="https://ian-flores.github.io/securetrace/articles/cloud-native.html" class="external-link">vignette("cloud-native", package = "securetrace")</a></code> for
comprehensive configuration guides covering:</p>
<ul>
<li>
<strong>OTLP export</strong> – sending traces to Jaeger or Grafana
Tempo collectors</li>
<li>
<strong>Prometheus metrics</strong> – exposing span counts, token
usage, and cost as time-series metrics for dashboards and alerting</li>
<li>
<strong>W3C Trace Context</strong> – propagating trace IDs across
service boundaries</li>
<li>
<strong>Multi-exporter setup</strong> – combining OTLP, Prometheus,
and JSONL for complete observability</li>
</ul>
<p>Here is a minimal OTLP example to get started:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ian-flores.github.io/securetrace/reference/otlp_exporter.html" class="external-link">otlp_exporter</a></span><span class="op">(</span></span>
<span>  endpoint <span class="op">=</span> <span class="st">"http://localhost:4318"</span>,</span>
<span>  service_name <span class="op">=</span> <span class="st">"r-agent-pipeline"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://ian-flores.github.io/securetrace/reference/Trace.html" class="external-link">Trace</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"production-pipeline"</span><span class="op">)</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">pipeline</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Analyze mtcars."</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trace <span class="op">=</span> <span class="va">tr</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">end</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ian-flores.github.io/securetrace/reference/export_trace.html" class="external-link">export_trace</a></span><span class="op">(</span><span class="va">exp</span>, <span class="va">tr</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trace exported to http://localhost:4318/v1/traces</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="error-tracing">Error Tracing<a class="anchor" aria-label="anchor" href="#error-tracing"></a>
</h2>
<p>When a node fails, orchestr records the error on the span before
re-raising it. This means failed runs still produce useful traces – you
can see exactly which node failed, how long it ran before failing, and
what error message was produced. This is especially valuable for
intermittent failures in production.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="va"><a href="https://ian-flores.github.io/securetrace/reference/Trace.html" class="external-link">Trace</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"error-demo"</span><span class="op">)</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>  <span class="va">graph</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Trigger an error."</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    trace <span class="op">=</span> <span class="va">tr</span></span>
<span>  <span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Graph failed: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">conditionMessage</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">end</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The trace contains error information on the failed span</span></span>
<span><span class="va">tr</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trace: error-demo</span></span>
<span><span class="co">#&gt;   Spans: 1</span></span>
<span><span class="co">#&gt;   Duration: 0.5s</span></span>
<span><span class="co">#&gt;   node:supervisor -- 0.5s (error)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>
<strong><a href="quickstart.html">Getting Started</a></strong> –
single-agent basics and provider setup</li>
<li>
<strong><a href="multi-agent.html">Multi-Agent
Workflows</a></strong> – pipelines and supervisors</li>
<li>
<strong><a href="securer.html">Secure Execution</a></strong> –
sandboxed code execution with securer</li>
<li>
<strong><a href="governed-agent.html">Governed Agent</a></strong> –
the full 7-package stack</li>
<li>
<strong>securetrace</strong>:
<code><a href="https://ian-flores.github.io/securetrace/articles/observability.html" class="external-link">vignette("observability", package = "securetrace")</a></code> – trace
fundamentals</li>
<li>
<strong>securetrace</strong>:
<code><a href="https://ian-flores.github.io/securetrace/articles/cloud-native.html" class="external-link">vignette("cloud-native", package = "securetrace")</a></code> – OTLP,
Prometheus, W3C</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ian Flores Siaca.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
