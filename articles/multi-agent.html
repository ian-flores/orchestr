<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Multi-Agent Workflows • orchestr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multi-Agent Workflows">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orchestr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ian-flores/orchestr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Multi-Agent Workflows</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ian-flores/orchestr/blob/main/vignettes/multi-agent.Rmd" class="external-link"><code>vignettes/multi-agent.Rmd</code></a></small>
      <div class="d-none name"><code>multi-agent.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="choosing-a-multi-agent-pattern">Choosing a Multi-Agent Pattern<a class="anchor" aria-label="anchor" href="#choosing-a-multi-agent-pattern"></a>
</h2>
<p>When a single agent is not enough – because the task has distinct
stages, or because different subtasks require different expertise –
orchestr provides two multi-agent patterns: <strong>pipelines</strong>
and <strong>supervisors</strong>. Choosing between them is the first
design decision for any multi-agent workflow.</p>
<p>A <strong>pipeline</strong> is the right choice when you know the
sequence of steps at design time. Data flows linearly from one
specialist to the next, like an assembly line. Each agent makes exactly
one LLM call, so costs are predictable and execution order is
deterministic.</p>
<p>A <strong>supervisor</strong> is the right choice when the routing
depends on the content of the request. A coordinator agent reads the
user’s message, decides which specialist should handle it, and
dispatches accordingly. The supervisor can route to multiple workers
across several iterations, making it suitable for open-ended tasks where
the needed expertise is not known in advance.</p>
<p>Here is a comparison of the two patterns:</p>
<pre><code> Pattern     | Flow          | LLM Calls  | Best For
 ------------|---------------|------------|----------------------------------
 Pipeline    | A -&gt; B -&gt; C   | 1 per node | Fixed stages, predictable cost
 Supervisor  | Router -&gt; *   | 2+ per     | Dynamic routing, open-ended tasks
             |               | iteration  |</code></pre>
<p>If your workflow has a fixed sequence of steps, start with a
pipeline. If the routing logic depends on the user’s input, use a
supervisor. If you need something more complex (conditional branches,
cycles, human-in-the-loop approvals), drop down to
<code><a href="../reference/graph_builder.html">graph_builder()</a></code> for full control over the topology.</p>
</div>
<div class="section level2">
<h2 id="pipeline-pattern">Pipeline Pattern<a class="anchor" aria-label="anchor" href="#pipeline-pattern"></a>
</h2>
<p>A pipeline passes state through a sequence of agents, each
transforming it before handing off to the next. The key idea is
<strong>separation of concerns</strong>: each agent has a focused role,
and the pipeline composes them into a coherent workflow. This makes
individual agents easier to test, swap, and reason about compared to a
single monolithic prompt.</p>
<p>The pipeline flow looks like this:</p>
<pre><code> [User Input]
      |
      v
 +-----------+     +-----------+     +-----------+
 |  Agent A  | --&gt; |  Agent B  | --&gt; |  Agent C  |
 | (profile) |     | (analyze) |     |  (report) |
 +-----------+     +-----------+     +-----------+
                                          |
                                          v
                                    [Final Output]</code></pre>
<p>Use <code><a href="../reference/pipeline_graph.html">pipeline_graph()</a></code> for a concise setup, or
<code><a href="../reference/graph_builder.html">graph_builder()</a></code> for full control.</p>
<div class="section level3">
<h3 id="using-pipeline_graph">Using <code>pipeline_graph()</code><a class="anchor" aria-label="anchor" href="#using-pipeline_graph"></a>
</h3>
<p>The simplest way to create a pipeline. Pass agents in order and
orchestr wires the edges automatically.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ian-flores.github.io/orchestr/">orchestr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ellmer.tidyverse.org" class="external-link">ellmer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">drafter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"drafter"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Write a short draft on the given topic."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">editor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"editor"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Improve the following draft. Fix grammar and clarity."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pipeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pipeline_graph.html">pipeline_graph</a></span><span class="op">(</span><span class="va">drafter</span>, <span class="va">editor</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">pipeline</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Write about the benefits of open source software."</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">messages</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">messages</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-analysis-pipeline">Data Analysis Pipeline<a class="anchor" aria-label="anchor" href="#data-analysis-pipeline"></a>
</h3>
<p>A more realistic pipeline that profiles data, analyzes patterns, and
produces a report. This three-stage design is common in data science
workflows: the profiler gathers facts, the analyst finds meaning, and
the reporter communicates results. Each agent sees the accumulated
conversation history, so the analyst can reference the profiler’s output
and the reporter can reference both.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">profiler</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"profiler"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Profile datasets: describe columns, types, missing values, distributions."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">analyst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"analyst"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Given a data profile, identify patterns, correlations, and anomalies."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reporter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"reporter"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Write a clear, non-technical summary of analytical findings."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pipeline_graph.html">pipeline_graph</a></span><span class="op">(</span><span class="va">profiler</span>, <span class="va">analyst</span>, <span class="va">reporter</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">graph</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Analyze the mtcars dataset focusing on fuel efficiency factors."</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-graph_builder-directly">Using <code>graph_builder()</code> Directly<a class="anchor" aria-label="anchor" href="#using-graph_builder-directly"></a>
</h3>
<p>For more control – conditional edges, cycles, or custom node
functions – use the builder API. This is the same API that
<code><a href="../reference/pipeline_graph.html">pipeline_graph()</a></code> and <code><a href="../reference/supervisor_graph.html">supervisor_graph()</a></code> use
internally. The builder gives you full access to the graph topology: add
nodes, wire edges (including conditional edges), and set the entry point
explicitly.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">drafter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"drafter"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Write a short draft on the given topic."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">editor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"editor"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Improve the following draft. Fix grammar and clarity."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graph_builder.html">graph_builder</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">g</span><span class="op">$</span><span class="fu">add_node</span><span class="op">(</span><span class="st">"draft"</span>, <span class="va">drafter</span><span class="op">)</span></span>
<span><span class="va">g</span><span class="op">$</span><span class="fu">add_node</span><span class="op">(</span><span class="st">"edit"</span>, <span class="va">editor</span><span class="op">)</span></span>
<span><span class="va">g</span><span class="op">$</span><span class="fu">add_edge</span><span class="op">(</span><span class="st">"draft"</span>, <span class="st">"edit"</span><span class="op">)</span></span>
<span><span class="va">g</span><span class="op">$</span><span class="fu">add_edge</span><span class="op">(</span><span class="st">"edit"</span>, <span class="va">END</span><span class="op">)</span></span>
<span><span class="va">g</span><span class="op">$</span><span class="fu">set_entry_point</span><span class="op">(</span><span class="st">"draft"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pipeline</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">$</span><span class="fu">compile</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">pipeline</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Write about functional programming in R."</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">messages</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">messages</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="supervisor-pattern">Supervisor Pattern<a class="anchor" aria-label="anchor" href="#supervisor-pattern"></a>
</h2>
<p>While pipelines follow a fixed path, supervisors make <strong>dynamic
routing decisions</strong> at runtime. A supervisor agent receives the
user’s request, evaluates which specialist is best suited to handle it,
and dispatches the work using a <code>route</code> tool that orchestr
injects automatically. After the worker responds, control returns to the
supervisor, which can route again (to a different worker, or the same
one) or finish.</p>
<p>This pattern is powerful for open-ended tasks where the required
expertise depends on the input. A question about calculus goes to the
math worker; a request to polish prose goes to the writing worker. The
supervisor makes this decision using the LLM’s own judgment, guided by
its system prompt and the worker descriptions.</p>
<p>The routing flow looks like this:</p>
<pre><code>                 +------------+
                 | Supervisor |
                 +-----+------+
                       |
          route("math") | route("writing") | FINISH
               |                |               |
               v                v               v
          +--------+      +----------+      [Output]
          |  Math  |      | Writing  |
          +--------+      +----------+
               |                |
               +----+     +----+
                    |     |
                    v     v
               (back to Supervisor)</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">supervisor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"supervisor"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"You coordinate workers to solve tasks."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">math_worker</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"math"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"You are a math expert. Solve math problems step by step."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">writing_worker</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"writing"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"You are a writing expert. Help with writing tasks."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/supervisor_graph.html">supervisor_graph</a></span><span class="op">(</span></span>
<span>  supervisor <span class="op">=</span> <span class="va">supervisor</span>,</span>
<span>  workers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>math <span class="op">=</span> <span class="va">math_worker</span>, writing <span class="op">=</span> <span class="va">writing_worker</span><span class="op">)</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Route to math</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">graph</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Calculate the integral of x^2 from 0 to 1."</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The supervisor automatically receives a <code>route</code> tool that
it calls to dispatch to workers or finish. Start with low
<code>max_iterations</code> values to control costs – each iteration
involves an LLM call for the supervisor plus the selected worker.</p>
</div>
<div class="section level2">
<h2 id="state-management">State Management<a class="anchor" aria-label="anchor" href="#state-management"></a>
</h2>
<p>All graph types in orchestr share a common state model. State is a
named list that flows through the graph, getting modified by each node.
By default, orchestr uses a simple schema where <code>messages</code> is
a list that gets appended to as agents respond.</p>
<p>Understanding state flow matters because it determines what each
agent sees. In a pipeline, the second agent sees the first agent’s
output in the message history. In a supervisor, each worker sees the
full conversation including the supervisor’s routing decisions. This
shared-state design means agents can build on each other’s work without
explicit message passing.</p>
<p>For advanced use cases, <code>StateSchema$new()</code> lets you
define typed fields with custom reducers. For example, you might
accumulate a <code>findings</code> list across pipeline stages while
keeping a <code>summary</code> field that gets overwritten by the final
agent.</p>
</div>
<div class="section level2">
<h2 id="streaming-state-snapshots">Streaming State Snapshots<a class="anchor" aria-label="anchor" href="#streaming-state-snapshots"></a>
</h2>
<p>Use <code>$stream()</code> to collect state snapshots at each step.
This is useful for building progress indicators in interactive
applications, or for debugging graph execution by inspecting
intermediate states.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pipeline_graph.html">pipeline_graph</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"drafter"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>    system_prompt <span class="op">=</span> <span class="st">"Write a short draft on the given topic."</span></span>
<span>  <span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"editor"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>    system_prompt <span class="op">=</span> <span class="st">"Improve the following draft."</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">snapshots</span> <span class="op">&lt;-</span> <span class="va">pipeline</span><span class="op">$</span><span class="fu">stream</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Write about functional programming in R."</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">snap</span> <span class="kw">in</span> <span class="va">snapshots</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Step %d, node: %s\n"</span>, <span class="va">snap</span><span class="op">$</span><span class="va">step</span>, <span class="va">snap</span><span class="op">$</span><span class="va">node</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualizing-the-graph">Visualizing the Graph<a class="anchor" aria-label="anchor" href="#visualizing-the-graph"></a>
</h2>
<p>Understanding the topology of a graph is easier with a visual
representation. <code><a href="../reference/as_mermaid.html">as_mermaid()</a></code> generates a Mermaid diagram
string that you can render in any Mermaid-compatible viewer (GitHub
markdown, pkgdown sites, Quarto documents, or the Mermaid live
editor).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">supervisor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"supervisor"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"You coordinate workers."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">math_worker</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"math"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Math expert."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">writing_worker</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"writing"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Writing expert."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/supervisor_graph.html">supervisor_graph</a></span><span class="op">(</span></span>
<span>  supervisor <span class="op">=</span> <span class="va">supervisor</span>,</span>
<span>  workers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>math <span class="op">=</span> <span class="va">math_worker</span>, writing <span class="op">=</span> <span class="va">writing_worker</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_mermaid.html">as_mermaid</a></span><span class="op">(</span><span class="va">graph</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Output:</span></span>
<span><span class="co"># graph TD</span></span>
<span><span class="co">#     supervisor[supervisor]</span></span>
<span><span class="co">#     math[math]</span></span>
<span><span class="co">#     writing[writing]</span></span>
<span><span class="co">#     supervisor --&gt;|math| math</span></span>
<span><span class="co">#     supervisor --&gt;|writing| writing</span></span>
<span><span class="co">#     math --&gt; supervisor</span></span>
<span><span class="co">#     writing --&gt; supervisor</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>
<strong><a href="quickstart.html">Getting Started</a></strong> –
single-agent basics and provider setup</li>
<li>
<strong><a href="securer.html">Secure Execution</a></strong> –
sandboxed code execution with securer</li>
<li>
<strong><a href="tracing.html">Traced Workflows</a></strong> –
observability with securetrace</li>
<li>
<strong><a href="governed-agent.html">Governed Agent</a></strong> –
the full 7-package stack</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ian Flores Siaca.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
