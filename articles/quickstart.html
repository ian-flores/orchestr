<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started with orchestr • orchestr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with orchestr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orchestr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ian-flores/orchestr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting Started with orchestr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ian-flores/orchestr/blob/main/vignettes/quickstart.Rmd" class="external-link"><code>vignettes/quickstart.Rmd</code></a></small>
      <div class="d-none name"><code>quickstart.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="what-problem-does-orchestr-solve">What problem does orchestr solve?<a class="anchor" aria-label="anchor" href="#what-problem-does-orchestr-solve"></a>
</h2>
<p>Large language models work well on their own, but building a
production agent requires more than a single prompt-response exchange. A
production agent needs structured reasoning loops, pipelines that chain
specialists together, supervisors that route work to the right expert,
and controls that keep the whole system observable, checkpointable, and
safe.</p>
<p>orchestr is a graph-based orchestration layer for R that sits on top
of <a href="https://github.com/tidyverse/ellmer" class="external-link">ellmer</a> (the LLM
chat interface) and optionally <a href="https://github.com/ian-flores/securer" class="external-link">securer</a> (sandboxed code
execution). Instead of writing ad-hoc loops and if-else routing, you
define agents, wire them into a graph, and let orchestr handle execution
flow, state management, and iteration control.</p>
<p>Agents are nodes, edges define flow, and the graph runtime handles
the rest. Whether you need a single ReAct agent, a three-stage pipeline,
or a supervisor that dynamically routes to a pool of workers, the same
graph primitives apply.</p>
<div class="section level3">
<h3 id="the-react-pattern">The ReAct pattern<a class="anchor" aria-label="anchor" href="#the-react-pattern"></a>
</h3>
<p>orchestr’s default execution model follows the ReAct (Reasoning +
Acting) pattern. The agent repeatedly thinks about what to do, takes an
action (typically a tool call), observes the result, and decides whether
to continue or stop:</p>
<pre><code> think --&gt; act --&gt; observe
   ^                  |
   |                  |
   +------ loop ------+
         (until done or max iterations)</code></pre>
<p>This loop is implemented by <code><a href="../reference/react_graph.html">react_graph()</a></code> and runs
within a safety cap (<code>max_iterations</code>) to prevent runaway LLM
calls.</p>
</div>
<div class="section level3">
<h3 id="when-to-use-orchestr-vs--plain-ellmer">When to use orchestr vs. plain ellmer<a class="anchor" aria-label="anchor" href="#when-to-use-orchestr-vs--plain-ellmer"></a>
</h3>
<p>If your use case is a single prompt-response exchange, plain ellmer
is the right choice. ellmer handles tool call loops internally, supports
streaming, and has minimal overhead.</p>
<p>Reach for orchestr when you need one or more of:</p>
<ul>
<li>Multi-agent workflows: pipelines, supervisors, or custom graph
topologies</li>
<li>State management: typed state schemas with reducers that accumulate
results across nodes</li>
<li>Checkpointing: save and resume graph execution mid-run</li>
<li>Observability: automatic span creation when combined with
securetrace</li>
<li>Iteration control: max_iterations caps, conditional routing,
interrupt and approval flows</li>
</ul>
<p>ellmer runs a single agent with tools; orchestr composes multiple
agents into governed workflows.</p>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"orchestr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="api-key-setup">API key setup<a class="anchor" aria-label="anchor" href="#api-key-setup"></a>
</h2>
<p>orchestr uses <a href="https://github.com/tidyverse/ellmer" class="external-link">ellmer</a> for LLM access.
Set your provider’s API key before running any examples:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For Anthropic (Claude)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>ANTHROPIC_API_KEY <span class="op">=</span> <span class="st">"your-key-here"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For OpenAI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>OPENAI_API_KEY <span class="op">=</span> <span class="st">"your-key-here"</span><span class="op">)</span></span></code></pre></div>
<p>See ellmer’s documentation for all supported providers.</p>
</div>
<div class="section level2">
<h2 id="using-different-providers">Using different providers<a class="anchor" aria-label="anchor" href="#using-different-providers"></a>
</h2>
<p>orchestr works with any ellmer chat backend. Pass the appropriate
<code>chat_*()</code> constructor to <code><a href="../reference/Agent.html">agent()</a></code> and everything
works the same regardless of the backing model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ian-flores.github.io/orchestr/">orchestr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ellmer.tidyverse.org" class="external-link">ellmer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># OpenAI</span></span>
<span><span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"analyst"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_openai.html" class="external-link">chat_openai</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"gpt-4o"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Google Gemini</span></span>
<span><span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"analyst"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_google_gemini.html" class="external-link">chat_google_gemini</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"gemini-1.5-pro"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Claude via AWS Bedrock</span></span>
<span><span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"analyst"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_aws_bedrock.html" class="external-link">chat_aws_bedrock</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">"anthropic.claude-3-5-sonnet-20241022-v2:0"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># GPT-4o via Azure OpenAI</span></span>
<span><span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"analyst"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_azure_openai.html" class="external-link">chat_azure_openai</a></span><span class="op">(</span></span>
<span>  endpoint <span class="op">=</span> <span class="st">"https://my-resource.openai.azure.com"</span>,</span>
<span>  deployment_id <span class="op">=</span> <span class="st">"gpt-4o"</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>All graph types (<code><a href="../reference/react_graph.html">react_graph()</a></code>,
<code><a href="../reference/pipeline_graph.html">pipeline_graph()</a></code>, <code><a href="../reference/supervisor_graph.html">supervisor_graph()</a></code>) work
identically regardless of which provider backs the agent.</p>
</div>
<div class="section level2">
<h2 id="your-first-agent">Your first agent<a class="anchor" aria-label="anchor" href="#your-first-agent"></a>
</h2>
<p>An <code>Agent</code> wraps an ellmer <code>Chat</code> object with a
name and an optional system prompt. The <code><a href="../reference/Agent.html">agent()</a></code> constructor
validates inputs, applies defaults, and returns an R6 <code>Agent</code>
instance that manages conversation state and tool registration.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ian-flores.github.io/orchestr/">orchestr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ellmer.tidyverse.org" class="external-link">ellmer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">analyst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"analyst"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"You are a data analyst. Analyze data and provide insights."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Single-turn conversation</span></span>
<span><span class="va">response</span> <span class="op">&lt;-</span> <span class="va">analyst</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span><span class="st">"Describe the key features of the iris dataset."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-tools">Adding tools<a class="anchor" aria-label="anchor" href="#adding-tools"></a>
</h2>
<p>Tools let an agent call R functions as part of its reasoning –
looking up data, running calculations, querying databases. ellmer’s
<code>Chat</code> class handles tool call loops internally. When the
model decides to use a tool, ellmer executes the function and feeds the
result back, so the agent can observe real data and adjust its
response.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_tool</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/tool.html" class="external-link">tool</a></span><span class="op">(</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">dataset_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">dataset_name</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html" class="external-link">asNamespace</a></span><span class="op">(</span><span class="st">"datasets"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  <span class="st">"Get a summary of a built-in R dataset."</span>,</span>
<span>  arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    dataset_name <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/type_boolean.html" class="external-link">type_string</a></span><span class="op">(</span><span class="st">"Name of a dataset in the datasets package"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">analyst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"analyst"</span>,</span>
<span>  chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>    system_prompt <span class="op">=</span> <span class="st">"You are a data analyst. Use your tools to examine data."</span></span>
<span>  <span class="op">)</span>,</span>
<span>  tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">summary_tool</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">response</span> <span class="op">&lt;-</span> <span class="va">analyst</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span><span class="st">"Summarize the mtcars dataset."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="single-agent-graph-with-react_graph">Single-agent graph with <code>react_graph()</code><a class="anchor" aria-label="anchor" href="#single-agent-graph-with-react_graph"></a>
</h2>
<p><code><a href="../reference/react_graph.html">react_graph()</a></code> wraps a single agent in a graph that adds
three things a bare agent lacks: state management (a typed state object
persists across iterations), checkpointing (save and resume mid-run),
and tracing (pass a securetrace <code>Trace</code> to instrument every
iteration). The graph interface (<code>$invoke()</code>,
<code>$stream()</code>) stays the same whether you run one agent or
many.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">analyst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"analyst"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"You are a data analyst. Analyze data and provide insights."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/react_graph.html">react_graph</a></span><span class="op">(</span><span class="va">analyst</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">graph</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"What are the key relationships in the mtcars dataset?"</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Use <code>verbose = TRUE</code> when compiling to see execution flow.
With the convenience functions, pass <code>verbose</code> to
<code>$invoke()</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">graph</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Describe the distribution of mpg in mtcars."</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="agent-pipeline-with-pipeline_graph">Agent pipeline with <code>pipeline_graph()</code><a class="anchor" aria-label="anchor" href="#agent-pipeline-with-pipeline_graph"></a>
</h2>
<p>When a task breaks into distinct stages (profile the data, analyze
patterns, write a report), a pipeline chains agents in sequence. Each
agent processes the shared state and passes it forward. Pipelines cost
less than supervisors because each agent makes exactly one LLM call, and
the execution order is fixed at graph construction time.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">profiler</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"profiler"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Profile datasets: describe columns, types, missing values, distributions."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">analyst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Agent.html">agent</a></span><span class="op">(</span><span class="st">"analyst"</span>, chat <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_anthropic.html" class="external-link">chat_anthropic</a></span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="st">"Given a data profile, identify patterns, correlations, and anomalies."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pipeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pipeline_graph.html">pipeline_graph</a></span><span class="op">(</span><span class="va">profiler</span>, <span class="va">analyst</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">pipeline</span><span class="op">$</span><span class="fu">invoke</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Analyze the mtcars dataset focusing on fuel efficiency factors."</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>
<a href="multi-agent.html">Multi-agent workflows</a>: pipelines,
supervisor routing, and visualization</li>
<li>
<a href="securer.html">Secure execution</a>: sandboxed code
execution with securer</li>
<li>
<a href="tracing.html">Traced workflows</a>: observability with
securetrace</li>
<li>
<a href="governed-agent.html">Governed agent</a>: the full 7-package
stack</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ian Flores Siaca.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
